# Node payment, rewards and risk

Here you can read about [paid services nodes can perform](https://partisiablockchain.gitlab.io/documentation/node-operations/start-running-a-node.html#which-node-should-you-run) as well as rewards, and risks of disputes.

#### How different node services earn fees and rewards <a href="#how-different-node-services-earn-fees-and-rewards" id="how-different-node-services-earn-fees-and-rewards"></a>

Node operators get paid fees for running four [types of services](https://partisiablockchain.gitlab.io/documentation/node-operations/start-running-a-node.html#which-node-should-you-run):

* Baker services - signing and producing blocks. Baker fees depend on performance measured by peers
* ZK services - preprocessing data, executing ZK computations. [See the fees paid for different ZK operations](https://partisiablockchain.gitlab.io/documentation/smart-contracts/gas/zk-computation-gas-fees.html)
* Oracle services - services related to BYOC, signing transfers. Deposit and withdrawal oracle nodes receive 0.1% of transferred value
* Price oracle nodes get a steady fee per signed price. The fee is 50K gas divided equally between the price signatories

A node operator earns fees when a user commits a transaction on the blockchain and pays a gas cost in [BYOC](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/byoc/byoc.html). The gas spent covers the fee of the service performed by the nodes, this designs ensures that node operators get paid in BYOC tokens.

In addition to the fees paid for services, node operators and delegated stakers receive rewards in the form of MPC tokens from staking. Rewards are distributed according to the amount of tokens staked and node performance. [See how rewards are calculated and distributed](https://gitlab.com/partisiablockchain/node-operators-rewards/-/tree/main/mainnet?ref_type=heads#computing-rewards)

#### How are baker fees calculated <a href="#how-are-baker-fees-calculated" id="how-are-baker-fees-calculated"></a>

Baker service fees depend on both the performance of the individual node and the level of activity on-chain, meaning the number and size of transactions committed in each [epoch](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/dictionary.html#epoch). It is important for the node operator to keep up to date to keep earning fees.

Fees for baker service are paid out by the [Fee distribution contract](https://browser.partisiablockchain.com/contracts/04fe17d1009372c8ed3ac5b790b32e349359c2c7e9?tab=state). In the state of the contract you can see a collapsed map placed to the right of the field called `epochs`:

1. Click the map right of `epochs`
2. Unfold the successive maps and structs until you reach `metrics`

The map called `metrics` holds node operator addresses. Next to the address of each node in the network you find a list called `signatureFrequencies`. The `signatureFrequencies` tells you how many signatures on blocks the node has seen so far from each of the other nodes in the network in the current [epoch](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/dictionary.html#epoch). When every node has produced 100 blocks, the [epoch](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/dictionary.html#epoch) is over and earned fees are distributed equally among the nodes receiving a vote from 2/3s of the nodes. A peer node will count how often your node's signature has appeared on a block it has seen. It creates a sorted list of the performers and casts a vote for each node in the top 2/3s.\
Everyone that has received a vote from 2/3s of the committee gets paid an equal share of the fees of the epoch. If there are 100 nodes in the [current committee](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/dictionary.html#committee) then your node needs a vote from 66 other nodes each epoch to get paid.

#### How staking of MPC tokens work <a href="#how-staking-of-mpc-tokens-work" id="how-staking-of-mpc-tokens-work"></a>

Staked [MPC tokens](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/dictionary.html#mpc-token) are used as collateral for a node [performing a paid service](https://partisiablockchain.gitlab.io/documentation/node-operations/start-running-a-node.html#which-node-should-you-run). Collateral is the stake of a node, which will be used to pay compensation for misconduct committed with the node. For all services on PBC there is a basic safety principle:

. The safety principle can be showcased through the application of it in the oracle service and the ZK service, explained below:

Three [oracle nodes](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/dictionary.html#oracle-node) performing oracle service together constitutes one [small oracle](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/byoc/bridging-byoc-by-sending-transactions.html#bridgeable-coins-on-mainnet). A small oracle can transfer less value than the total stake on the service (750K MPC). The theoretical maximum value of [BYOC](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/dictionary.html#byoc) being bridged per [epoch](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/dictionary.html#epoch) is equivalent to the ETH value of the total stake (collateral) of the three oracle nodes. In current practice the value that can be transferred is 50 ETH for withdrawal oracles and 25 ETH for deposit oracles.

Four [ZK nodes](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/dictionary.html) performing ZK service together have an equal share in the total stake on the service, just like oracle nodes. A ZK node stakes 1/4 of the amount defined in the ZK contract to which they are allocated. The contract owner defines the total required stake to participate in the ZK job.

When tokens are allocated to a node service, the tokens are always locked to the [system contract](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/governance-system-smart-contracts-overview.html) administrating the service for one [epoch](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/dictionary.html#epoch). See how the length of an epoch is determined [here](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/dictionary.html#epoch).

A node operator can resign from a service, and retrieve the tokens staked on the service. A delay of release ensures sufficient time for the service to complete and for the possibility of dispute claims. For this reason there are pending times for MPC tokens to change state from being [associated](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/mpc-token-model-and-account-elements.html#allocatedtojobs) , [locked](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/mpc-token-model-and-account-elements.html#allocatedtojobs) or [staked](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/mpc-token-model-and-account-elements.html#staked). [Changing state](https://browser.partisiablockchain.com/node-operation) from _staked_ to _unstaked_ always takes 7 days plus the [pending time for disassociation or unlocking](https://partisiablockchain.gitlab.io/documentation/node-operations/node-payment-rewards-and-risks.html#how-long-does-it-take-to-retrieve-stakes-from-a-node-service).

**How long does it take to retrieve stakes from a node service**

MPC tokens need to be unstaked and free from vesting schedule to be [transferable](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/mpc-token-model-and-account-elements.html#transferable). You can always calculate how many MPC tokens you can transfer with the formula:

When a node operator wants to retrieve his stake from a node service, he disassociates and unstakes the tokens currently associated to the contract administrating the node service. The node operator should be aware of the total pending time for removing tokens from a node service. The total pending time is the sum of pending time of the two actions: [disassociate](https://browser.partisiablockchain.com/node-operation) and [unstake](https://browser.partisiablockchain.com/node-operation). The table below explains the pending time for retrieving tokens from the contracts governing the different node services.

For in depth explanation of all states of MPC tokens in the accounts see [MPC Token Model](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/mpc-token-model-and-account-elements.html).

| **Token state**                                                                                                                                                                                                                                                                                                                                                                               | **Days in Pending** | **Explanation**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | **Required action**                                                                                                                                                                                                                                                                          |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| [_stakedTokens_](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/mpc-token-model-and-account-elements.html#staked)                                                                                                                                                                                                                                                        | 7                   | MPC tokens in the stakedTokens means that your tokens are deposited on chain. Tokens in this state can be associated by a node operator to a contract administrating a specific node service. Staked tokens can also be delegated from a token holder to a node operator.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | [Unstake](https://browser.partisiablockchain.com/node-operation) + [Check pending unstakes](https://browser.partisiablockchain.com/account)                                                                                                                                                  |
| <p><a href="https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/mpc-token-model-and-account-elements.html#allocatedtojobs"><em>stakedToContract</em></a>:<br><a href="https://browser.partisiablockchain.com/contracts/04f1ab744630e57fb9cfcd42e6ccbf386977680014">Large Oracle</a></p>                                                                                       | 14                  | <p>The large oracle contract holds the stake and registration of <a href="https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/dictionary.html#oracle-node">oracle nodes</a>. Tokens allocated to a specific deposit or withdrawal oracle are in pending state from the end of the <a href="https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/dictionary#epoch">epoch</a>.<br><br>If the oracle is 14 days old, the epoch can be ended prematurely by invoking <a href="https://partisiablockchain.gitlab.io/documentation/node-operations/run-a-deposit-or-withdrawal-oracle-node.html#request-new-oracle">Request a new oracle</a>. When the epoch has ended you can unlock old pending tokens, and disassociate the tokens from the large oracle contract afterwards.<br><br>If the node is not allocated to an active deposit or withdrawal oracle-contract you can disassociate immediately</p>                                                                                                                                                                                           | [Unlock old Pending Tokens](https://browser.partisiablockchain.com/contracts/04f1ab744630e57fb9cfcd42e6ccbf386977680014/unlockOldPendingTokens) + [Disassociate](https://browser.partisiablockchain.com/contracts/04f1ab744630e57fb9cfcd42e6ccbf386977680014/disassociateTokensFromContract) |
| <p><a href="https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/mpc-token-model-and-account-elements.html#allocatedtojobs"><em>stakedToContract</em></a>:<br><a href="https://browser.partisiablockchain.com/contracts/01a2020bb33ef9e0323c7a3210d5cb7fd492aa0d65">ZK Node Registry</a><br></p>                                                                               | 14                  | <p>The ZK node registry contract holds the stake and registration of <a href="https://partisiablockchain.gitlab.io/documentation/smart-contracts/zk-smart-contracts/zk-smart-contracts.html#what-is-zero-knowledge-smart-contracts">ZK nodes</a>. The ZK registry in the <a href="https://browser.partisiablockchain.com/contracts/01a2020bb33ef9e0323c7a3210d5cb7fd492aa0d65?tab=state">contract state</a> includes a map showing all nodes allocated to specific ZK contracts.<br><br>To check if your tokens are allocated to a <a href="https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/dictionary.html#mpc">ZK calculation</a>, you need to go to the state of <a href="https://browser.partisiablockchain.com/contracts/01a2020bb33ef9e0323c7a3210d5cb7fd492aa0d65?tab=state">ZKNR</a>, click <code>stakedTokens</code> map and find all current ZK contracts your node is engaged with.<br><br>In the state of the ZK contracts you can see the contract lifespan. From the moment the contract's lifespan or calculation is completed, the 14 day pending time starts for the allocated tokens.</p> | [Disassociate tokens](https://browser.partisiablockchain.com/contracts/01a2020bb33ef9e0323c7a3210d5cb7fd492aa0d65/disassociateTokens)                                                                                                                                                        |
| <p><a href="https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/mpc-token-model-and-account-elements.html#allocatedtojobs"><em>stakedToContract</em></a>:<br>Any price oracle, <a href="https://partisiablockchain.gitlab.io/documentation/node-operations/run-a-price-oracle-node.html#steps-to-deregister-as-a-price-oracle">find out which one your node serve</a><br></p> | 0-1                 | The price oracle contracts hold the stake and registration of [price oracle nodes](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/dictionary.html#price-oracle). You have to [Deregister](https://partisiablockchain.gitlab.io/documentation/node-operations/run-a-price-oracle-node.html#steps-to-deregister-as-a-price-oracle) outside a challenge period (the time until a proposed price is finalized). If you do that, disassociation is immediate.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | [Deregister](https://partisiablockchain.gitlab.io/documentation/node-operations/run-a-price-oracle-node.html#steps-to-deregister-as-a-price-oracle)                                                                                                                                          |
| <p><a href="https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/mpc-token-model-and-account-elements.html#allocatedtojobs"><em>stakedToContract</em></a>:<br><a href="https://browser.partisiablockchain.com/contracts/04203b77743ad0ca831df9430a6be515195733ad91">Block Producer Orchestration</a><br></p>                                                                   | 28                  | <p>The block producer orchestration contract holds the stake and registration of <a href="https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/dictionary.html#baker-node">baker nodes</a> By invoking <a href="https://browser.partisiablockchain.com/contracts/04203b77743ad0ca831df9430a6be515195733ad91/removeBp">Remove bp</a>, you both deregister and disassociate tokens from the contract.<br><br>If your node is in the <a href="https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/dictionary.html#committee">committee</a> when you invoke removal, the node will still serve in committee until rotation. You can manually <a href="https://browser.partisiablockchain.com/contracts/04203b77743ad0ca831df9430a6be515195733ad91/triggerNewCommittee">trigger a committee rotation</a> if the committee is at least 28 days old.<br><br>If your node is not in the current committee, the tokens will be disassociated from the contract immediately when invoking <em>Remove bp</em>.</p>                                                                                          | [Remove bp](https://browser.partisiablockchain.com/contracts/04203b77743ad0ca831df9430a6be515195733ad91/removeBp)                                                                                                                                                                            |

**Retrieving stakes that are delegated**

If a node is using [delegated stakes](https://partisiablockchain.gitlab.io/documentation/node-operations/delegated-staking.html), the delegator has to reach out to the node operator using the tokens to ask for release, if they wish to retrieve them. Same locking mechanisms and pending times apply to tokens that come from delegated stakes. Delegated MPC tokens, that are not associated to a contract or locked to a service, can be retrieved without any pending period.

Rules:

* If [delegated to an account](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/mpc-token-model-and-account-elements.html#delegatedtoothers) of a node operator, but not [associated to a contract](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/mpc-token-model-and-account-elements.html#allocatedtojobs), token owner can retrieve with no issues
* If [delegated to an account](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/mpc-token-model-and-account-elements.html#delegatedtoothers) of a node operator, and [associated to a contract](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/mpc-token-model-and-account-elements.html#allocatedtojobs) but not being used for a job, token owner cannot retrieve before the node operator has disassociated the token from the job
* If [delegated to the account](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/mpc-token-model-and-account-elements.html#delegatedtoothers) of a node operator, [associated to a contract](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/mpc-token-model-and-account-elements.html#allocatedtojobs) and being used for a job, token owner cannot retrieve until the job completes, pending period is over, and the node operator has disassociated the tokens from the job
* Tokens retrieved from delegation are not immediately [transferable](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/mpc-token-model-and-account-elements.html#transferable). The token owner must [unstake](https://browser.partisiablockchain.com/node-operation) the tokens after retrieval. If the tokens have passed the [release date](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/mpc-token-model-and-account-elements.html#unlocking-schedules) the tokens will become transferable, when the 7-day pending period is over and the owner invokes [Check pending unstakes](https://browser.partisiablockchain.com/account)
* Tokens must be retrieved to your account before you can [unstake](https://browser.partisiablockchain.com/node-operation). This means you change the state of the tokens back from staked to unstaked. Unstaking causes a 7-day pending state for the tokens. Afterwards you need to invoke [Check pending unstakes](https://browser.partisiablockchain.com/account). This operation returns the tokens to your balance

**Rewards for staked tokens**

Every quarter rewards are given to delegated stakers and node operators based on the amount of tokens staked and node performance.

When you delegate tokens to a node operator you get rewards when a node operator associates your [delegated](https://partisiablockchain.gitlab.io/documentation/node-operations/delegated-staking.html) tokens to a node service.

When each quarter ends the node operators decentrally calculate the amount of rewards to pay out and vote on-chain to pay out the rewards. See [Voting for QuarterlyRewards](https://partisiablockchain.gitlab.io/documentation/node-operations/node-health-and-maintenance.html#voting-for-quarterly-rewards)

You can consult the calculation method for rewards, and the history of quarterly payouts [here](https://gitlab.com/partisiablockchain/node-operators-rewards/-/blob/main/mainnet/README.md#computing-rewards).

#### Dispute claims and malicious behavior <a href="#dispute-claims-and-malicious-behavior" id="dispute-claims-and-malicious-behavior"></a>

Malicious node behavior can result in slashing of staked tokens (slashed tokens get burned). The purpose of slashing is to prevent malicious activity.

Examples of malicious activity

* A withdrawal oracle node signing a BYOC withdrawal that wasn't initiated on PBC
* A deposit oracle node signing a BYOC deposit that wasn't initiated on the external chain
* A price oracle node signing a wrong price
* An account starting an incorrect dispute

It is possible to start a dispute against a node operator that has done a service for you. Dispute claims are audited by the [large oracle](https://partisiablockchain.gitlab.io/documentation/pbc-fundamentals/dictionary.html#large-oracle). If the node operator is found responsible for the node's alleged malicious behavior tokens staked on the service may be slashed. Filing an illegitimate dispute claim against another node can also be considered malicious behavior and result in slashing.
